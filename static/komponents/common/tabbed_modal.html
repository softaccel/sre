<div class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"></div>
                <ul class="nav nav-pills">
                    <li class="nav-item">
                        <a data-toggle="tab" href="#sumar" class="nav-link" id="sumarTab">Sumar</a>
                    </li>
                </ul>
            </div>
            <div class="modal-body">
                <div class="tab-content">
                    <div class="tab-pane fade"></div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>

<script>
    function init_komponent(k) {

        let options = k.data;
        if(Object.keys(options).length===0) {
            komponentor.intent("/common/errormodal").send({body:"Invalid data to initialize <b>tabbed_modal</b>"});
            return;
        }


        let $modal = k.$el.filter(".modal").appendTo("body")
            .modal("show")
            .on("hidden.bs.modal",function () {
                k.$el.remove();
            });

        let $body = $modal.find(".modal-body");


        $modal.find(".modal-title").text(options.title);
        if(options.size && options.size!=="") {
            $modal.find(".modal-dialog").addClass("modal-"+options.size);
        }

        let menu = $modal.find(".nav");
        let menuItemTpl = menu.children().remove();

        let paneContent = $modal.find(".tab-content");
        let paneTpl = paneContent.children().remove();

        options.tabs.forEach(function (tab) {
            let shortCode = tab.label.replaceAll(" ","");
            let menuLink = menuItemTpl.clone(true).appendTo(menu).find("a")
                .attr("href","#pane"+shortCode)
                .attr("id","#tab"+shortCode)
                .text(tab.label);

            let pane = paneTpl.clone(true).appendTo(paneContent).attr("id","pane"+shortCode);
            switch (tab.type) {
                case "komponent":
                    let newKomp = $("<div>").appendTo(pane)
                        .attr("is","komponent");
                    if(tab.url) {
                        newKomp.data("url",tab.url);
                    }
                    let opts = {};
                    if(tab.data) {
                        opts.data = tab.data;
                    }
                    newKomp.komponent(opts);
                    break;
                default:
                    pane.append(tab.content ? tab.content : "");
            }

            if(tab.active) {
                pane.addClass("active show");
                menuLink.addClass("active");
            }

        });
    }
</script>

