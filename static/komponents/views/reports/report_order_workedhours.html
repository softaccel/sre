<div>
    <table class="table">
        <thead>
        <tr>
            <th>Comanda<br>
                <select class="custom-select-sm custom-select" name="order" style="width: 100%"></select></th>
            <th class="align-top">Operatie <input class="form-control form-control-sm"></th>
            <th class="align-top">Tarif orar</th>
            <th class="align-top">Ore lucrate</th>
            <th class="align-top">Total</th>
        </tr>
        </thead>
        <tbody id="raportAngajati" data-resourcetype="collection" data-type="report_agg_order_tt_op_empl">
        <tr>
            <td>
                <h5 class="">
                    <span class="badge-pill badge badge-dark"><%= attributes.docnum %></span>
                </h5>
                <a class="text-primary" style="cursor: pointer" onclick="komponentor.intent('/views/orders/order').data({orderId:$(this).data().instance.attributes.order}).send()">
                    <%= attributes.label + (attributes.comments ? " / "+ attributes.comments : "")  %>
                </a>
            </td>
            <td><%= attributes.opname %></td>
            <td><%= attributes.hourly_rate %></td>
            <td><%= attributes.d %> ore</td>
            <td><%= attributes.d *  attributes.hourly_rate %> ore</td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
            <td colspan="4"></td>
        </tr>
        </tfoot>
    </table>
</div>

<script>
    /* SELECT ROUND(SUM(duration)/60,2) d,employee, operation, LEFT(start,10) day,  `order` FROM timetracking tt GROUP BY `order`,operation,day, employee
ORDER BY `tt`.`employee` ASC */
    function init_komponent(k) {
        console.log(k);
        console.log(k.$el.find("[name=order]"));
        k.$el.find("[name=order]").select2wrapper({
            url: apiRoot+"/orders_extended",
            labelfld: "docnum",
            idfld: "id",
            placeholder: "Filtrare comenzi"
        });
        let url = apiRoot+"/report_agg_order_tt_op_empl?include=operation,order,employee";
        if(k.data && k.data.instance) {
            switch (k.data.instance.type) {
                case "employees":
                    url += "&filter=employee="+k.data.instance.id;
                    break;
                case "":
                    url += "&filter=employee="+k.data.instance.id;
            }
        }
        if(k.data && k.data.emplid) {
            url += "&filter=employee="+k.data.emplid;
        }
        if(k.data && k.data.emplid) {
            url += "&filter=employee="+k.data.emplid;
        }

        k.$el.find("#raportAngajati").apiator(url);
        console.log("Report loaded");

    }
</script>