<script>
    function init_komponent(k) {

        let jsonDec = jwt_decode(localStorage.getItem("spaleck")).sub;

        komponentor.intent("/common/formmodal").data({
            callback:function (data) {
                data = data.data;
                if (data.partner_id === null || data.model === "" || data.orderdate === "" || data.deliverydate === "") {
                    komponentor.intent("/common/errormodal").data({
                        body: "Toate datele trebuie completate."
                    }).send();
                    return 1;
                }

                data["user_id"] = jsonDec;
                k.data.instance.createItem(data).then(function () {
                    k.data.instance.view.el.children().last().find("td:nth-child(2)").click();
                }).catch(function(data){
                    komponentor.intent("/common/errormodal").data({
                        body: "A aparut o eroare:<pre>"+data.jqXHR.responseText+"</pre>"
                    }).send();
                });

                k.data.instance.view.el.children().last().fadeIn(500)[0].scrollIntoView();
            },
            title:"Adauga Comanda Noua",
            size: "lg",
            fields:[
                {type: "select", name: "partner_id", label: "Client", url: "/partners", labelfnc: "name", idfnc: "id"},
                {type: "text", name: "label", label: "Descriere"},
                {type: "select", name: "state", label: "Starea Comenzii", options: [{id: "offer", description: "Oferta"}, {id: "ord", description: "Comanda"}], default: {id: "offer", description: "Oferta"}}
            ],
        }).send();

    }
</script>